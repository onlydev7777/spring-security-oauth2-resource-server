# 1. OAuth2.0 Resource Server

- 클리아언트 서버 및 인가서버와의 통신을 담당
- 클라이언트의 접근을 제한하는 인가 정책 설정
- 인가 서버에서 발급한 Access-Token의 유효성 검증 및 접근 범위(scope)에 따라 적절한 자원 전달

***
### JWT

- JWT 로 전달되는 토큰을 검증하기 위한 JwtDecoder, BearerTokenAuthenticationFilter, JwtAuthenticationProvider 클래스 제공
- JWT 자체 검증 프로세스 지원

***
### Opaque
- 인가서버의 introspection 엔드 포인트로 검증할 수 있는 Opaque 토큰 지원
- 실시간으로 토큰 활성화 여부 확인

***
### 자동설정 초기화 과정

- OAuth2ResourceServerAutoConfiguration
  - import 
    1. OAuth2ResourceServerProperties
    2. Oauth2ResourceServerConfiguration.JwtConfiguration
    3. Oauth2ResourceServerConfiguration.OpaqueTokenConfiguration

```java
@AutoConfiguration(before = { SecurityAutoConfiguration.class, UserDetailsServiceAutoConfiguration.class })
@EnableConfigurationProperties(OAuth2ResourceServerProperties.class)
@ConditionalOnClass(BearerTokenAuthenticationToken.class)
@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)
@Import({ Oauth2ResourceServerConfiguration.JwtConfiguration.class,
		Oauth2ResourceServerConfiguration.OpaqueTokenConfiguration.class })
public class OAuth2ResourceServerAutoConfiguration {

}

```

***
- OAuth2ResourceServerProperties
  - application.yml 의 prefix 값 읽어서 세팅

```java
@ConfigurationProperties(prefix = "spring.security.oauth2.resourceserver")
public class OAuth2ResourceServerProperties {

  private final Jwt jwt = new Jwt();
  private final Opaquetoken opaqueToken = new Opaquetoken();
  
  //...(중략)
}
```

***
- Oauth2ResourceServerConfiguration
  - Jwt 설정 클래스 import
  - Opaque 설정 클래스 import

```java
class Oauth2ResourceServerConfiguration {

	@Configuration(proxyBeanMethods = false)
	@ConditionalOnClass(JwtDecoder.class)
	@Import({ OAuth2ResourceServerJwtConfiguration.JwtDecoderConfiguration.class,
			OAuth2ResourceServerJwtConfiguration.OAuth2SecurityFilterChainConfiguration.class })
	static class JwtConfiguration {

	}

	@Configuration(proxyBeanMethods = false)
	@Import({ OAuth2ResourceServerOpaqueTokenConfiguration.OpaqueTokenIntrospectionClientConfiguration.class,
			OAuth2ResourceServerOpaqueTokenConfiguration.OAuth2SecurityFilterChainConfiguration.class })
	static class OpaqueTokenConfiguration {

	}

}

```
